<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="userManagement">
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <h3>Manage Users</h3>
        <form th:action="@{/superadmin/create-user}" method="post" th:object="${newUser}">
            <div class="mb-3">
                <label class="form-label">Username</label>
                <input type="text" class="form-control" th:field="*{username}" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Password</label>
                <input type="password" class="form-control" th:field="*{password}" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" th:field="*{fullName}" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" th:field="*{email}" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Role</label>
                <select class="form-control" th:field="*{role}" required>
                    <option value="SUPER_ADMIN">Super Admin</option>
                    <option value="FACULTY_ADMIN">Faculty Admin</option>
                    <option value="VIEWER">Viewer</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Faculty (Optional)</label>
                <select class="form-control" th:field="*{faculty.id}">
                    <option value="">-- Select Faculty --</option>
                    <option th:each="faculty : ${faculties}" th:value="${faculty.id}" th:text="${faculty.name}"></option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Create User</button>
        </form>
        <table class="table mt-4">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Faculty</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="usr : ${users}">
                    <td th:text="${usr.username}"></td>
                    <td th:text="${usr.fullName}"></td>
                    <td th:text="${usr.email}"></td>
                    <td th:text="${usr.role}"></td>
                    <td th:text="${usr.faculty?.name} ?: 'N/A'"></td>
                    <td>
                        <form th:action="@{/superadmin/update-user}" method="post">
                            <input type="hidden" name="id" th:value="${usr.id}">
                            <input type="text" class="form-control" name="username" th:value="${usr.username}" required>
                            <input type="password" class="form-control" name="password" placeholder="New Password">
                            <input type="text" class="form-control" name="fullName" th:value="${usr.fullName}" required>
                            <input type="email" class="form-control" name="email" th:value="${usr.email}" required>
                            <select name="role" required>
                                <option value="SUPER_ADMIN" th:selected="${usr.role} == 'SUPER_ADMIN'">Super Admin</option>
                                <option value="FACULTY_ADMIN" th:selected="${usr.role} == 'FACULTY_ADMIN'">Faculty Admin</option>
                                <option value="VIEWER" th:selected="${usr.role} == 'VIEWER'">Viewer</option>
                            </select>
                            <select name="faculty.id">
                                <option value="">-- Select Faculty --</option>
                                <option th:each="faculty : ${faculties}" th:value="${faculty.id}" th:text="${faculty.name}" th:selected="${usr.faculty?.id} == ${faculty.id}"></option>
                            </select>
                            <button type="submit" class="btn btn-warning">Update</button>
                        </form>
                        <form th:action="@{/superadmin/delete-user}" method="post">
                            <input type="hidden" name="id" th:value="${usr.id}">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>